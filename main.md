```python
# This code defines a function `split_into_chunks` that takes a file path as input, reads the content of the file, and splits it into chunks based on double newline characters ("\n\n"). The function returns a list of these chunks.
from typing import List

def split_into_chunks(doc_file: str) -> List[str]:
    with open(doc_file, 'r', encoding='utf-8') as file:
        content = file.read()
    
    return [chunk for chunk in content.split("\n\n")]

chunks = split_into_chunks("doc.md")

for i, chunk in enumerate(chunks):
    print(f"[{i}] {chunk}\n")
```

    [0] 哆啦A梦与超级赛亚人：时空之战
    在一个寻常的午后，大雄依旧坐在书桌前发呆，作业堆得像山，连第一页都没动。哆啦A梦在一旁翻着漫画，时不时叹口气，觉得这孩子还是一如既往的不靠谱。正当他们的生活照常进行时，一道强光突然从天而降，整个房间震动不已。光芒中走出一名金发少年，身披战甲、气势惊人，他就是来自未来的超级赛亚人——特兰克斯。他一出现便说出了惊人的话：未来的地球即将被黑暗势力摧毁，他来此是为了寻求哆啦A梦的帮助。
    
    [1] 哆啦A梦与大雄听后大惊，但也从特兰克斯坚定的眼神中读出了不容拒绝的决心。特兰克斯解释说，未来的敌人并非普通反派，而是一个名叫“黑暗赛亚人”的存在，他由邪恶科学家复制了贝吉塔的基因并加以改造，实力超乎想象。这个敌人不仅拥有赛亚人战斗力，还能操纵扭曲的时间能量，几乎无人可敌。特兰克斯已经独自战斗多年，但每一次都以惨败告终。他说：“科技，是我那个时代唯一缺失的武器，而你们，正好拥有它。”
    
    [2] 于是，哆啦A梦带着特兰克斯与大雄启动时光机，穿越到了那个即将崩溃的未来世界。眼前的景象令人震撼：城市沦为废墟，大地裂痕纵横，天空中浮动着压抑的黑雾。特兰克斯说，这正是黑暗赛亚人带来的结果，一切生命几乎都被抹杀，只剩他在苦苦支撑。大雄虽感到恐惧，但看到无辜的人类遭殃，内心逐渐燃起斗志。哆啦A梦则冷静地分析局势，决定使用他最强的三样秘密道具来对抗黑暗势力。
    
    [3] 三件秘密道具分别是：可以临时赋予超级战力的“复制斗篷”，能暂停时间五秒的“时间停止手表”，以及可在一分钟中完成一年修行的“精神与时光屋便携版”。大雄被推进精神屋内，在其中接受密集的训练，虽然只有几分钟现实时间，他却经历了整整一年的苦修。刚开始他依旧软弱，想放弃、想逃跑，但当他想起静香、父母，还有哆啦A梦那坚定的眼神时，他终于咬牙坚持了下来。出来之后，他的身体与精神都焕然一新，眼神中多了一份成熟与自信。
    
    [4] 最终战在黑暗赛亚人的空中要塞前爆发，特兰克斯率先出击，释放全力与敌人正面对决。哆啦A梦则用任意门和道具支援，从各个方向制造混乱，尽量压制敌人的时空能力。但黑暗赛亚人太过强大，仅凭特兰克斯一人根本无法压制，更别说击败。就在特兰克斯即将被击倒之际，大雄披上复制斗篷、冲破恐惧从高空跃下。他的拳头燃烧着金色光焰，目标直指敌人心脏。
    
    [5] 时间停止装置在关键时刻启动，世界陷入静止，大雄用这个短短五秒接近了敌人的盲点。他集中全力，一记重拳击穿了黑暗赛亚人的能量核心，引发巨大的能量反冲。黑暗赛亚人尖叫着化为碎光，天空中的黑雾瞬间散去，阳光重新洒落大地。特兰克斯倒在地上，看着眼前这个曾经懦弱的少年，露出了欣慰的笑容。他知道，这一次，是大雄救了世界。
    
    [6] 战后，未来世界开始恢复，植物重新生长，人类重建家园。特兰克斯告别时紧紧握住大雄的手，说：“你是我见过最特别的战士。”哆啦A梦也为大雄感到骄傲，说他终于真正成长了一次。三人站在山丘上，看着远方重新明亮的地平线，心中感受到从未有过的安宁。随后，哆啦A梦与大雄乘坐时光机返回了属于他们的那个年代，一切仿佛又恢复平静。
    
    [7] 回到现代后，大雄仿佛变了一个人，不再轻易抱怨、不再逃避责任。他认真写完作业，帮妈妈买菜，甚至主动练习体育，哆啦A梦惊讶得说不出话来。他知道，这不是一时兴起，而是大雄真正内心成长的结果。大雄有时会望着天空出神，仿佛还能看见未来世界的那一片废墟与重生的希望。他不会说出来，但他心中永远铭记那一战。
    
    [8] 几天后，电视新闻中突然出现一则画面：一位金发少年在街头击退了失控的机器人，引发市民围观与猜测。大雄放下手中的课本，望向哆啦A梦，两人心照不宣地笑了。也许，特兰克斯又回来了，也许，新的敌人正在逼近。冒险从未真正结束，而他们，早已准备好了。无论时空如何动荡，他们将永远并肩作战。
    
    


```python
# This code snippet is using the SentenceTransformer library to load a pre-trained Chinese text embedding model called "shibing624/text2vec-base-chinese". It defines a function `embed_chunk` that takes a string input, encodes it using the loaded model, normalizes the embeddings, and returns the embeddings as a list of floats.

from typing import List
from sentence_transformers import SentenceTransformer

embedding_model = SentenceTransformer("shibing624/text2vec-base-chinese")

def embed_chunk(chunk: str) -> List[float]:
    embedding = embedding_model.encode(chunk, normalize_embeddings=True)
    return embedding.tolist()

embedding = embed_chunk("测试内容")
print(len(embedding))
print(embedding)
```

    768
    [0.026805492118000984, 0.008382015861570835, 0.0003433824167586863, 0.007298994809389114, 0.05433313921093941, -0.053255874663591385, 0.0013655510265380144, -0.0013182039838284254, -0.036711186170578, 0.07188180834054947, -0.007270667236298323, -0.007053060457110405, 0.04253281280398369, -0.03675277158617973, -0.054750584065914154, -0.00959851872175932, 0.017105532810091972, 0.05915364250540733, -0.03334997221827507, 0.06237657368183136, -0.004888507071882486, -0.03453953191637993, -0.07407599687576294, 0.04422193393111229, 0.010516940616071224, -0.03707784414291382, -0.027029842138290405, 0.03830360993742943, 0.02128247171640396, -0.011811531148850918, -0.0054087392054498196, 0.002659035613760352, -0.02329862117767334, 0.05299097299575806, 0.005149421747773886, 0.029624197632074356, -0.0308096744120121, -0.01785615086555481, 0.04244602099061012, -0.00769231328740716, -0.010638103820383549, 0.03210866078734398, -0.06592467427253723, -0.012100908905267715, 0.006814646068960428, -0.0011549752671271563, -0.020827779546380043, 0.027529532089829445, -0.04546990245580673, 0.0517701730132103, -0.05147430673241615, 0.25648605823516846, 0.05031633749604225, 0.01756426692008972, -0.011565230786800385, -0.01338955108076334, 0.016082607209682465, 0.018451234325766563, -0.006780534982681274, 0.031050026416778564, 0.05057543143630028, -0.01252979226410389, 0.0634862631559372, -0.04840283840894699, 0.0009180915076285601, 0.021004773676395416, -0.010703882202506065, -0.06085037812590599, 0.006804678123444319, 0.05067184194922447, -0.024943450465798378, -0.012201990932226181, 0.018374774605035782, 0.032339829951524734, 0.04231112822890282, 0.00020393698650877923, -0.017155028879642487, -0.016037998721003532, -0.037605319172143936, -0.043625108897686005, -0.04164879396557808, 0.016573466360569, 0.009964785538613796, -0.06010220944881439, -0.027282947674393654, 0.020031172782182693, 0.010414349846541882, -0.0475144125521183, -0.018612144514918327, -0.011965066194534302, -0.0626218393445015, -0.04016502946615219, -0.009429647587239742, 0.019113581627607346, 0.00968235358595848, 0.001971540506929159, 0.04423244670033455, -0.0038625074084848166, 0.00029381999047473073, 0.0358089916408062, -0.03436824306845665, -0.006869389209896326, -0.02950614131987095, 0.0021211516577750444, -0.016589490696787834, -0.014159883372485638, -0.01872505620121956, 1.734448414936196e-05, 0.0009454131359234452, 0.04507479816675186, 0.0064737312495708466, 0.03398651257157326, -0.0045067621394991875, 0.049304500222206116, -0.01237794291228056, 0.028520263731479645, 0.028152724727988243, -0.0120066087692976, 0.012232215143740177, 0.0034028892405331135, -0.015172944404184818, -0.02224712073802948, -0.014169566333293915, 0.023108843713998795, 0.009890863671898842, 0.04284042492508888, -0.030760997906327248, -0.03398944437503815, 0.01835842989385128, 0.03800961375236511, 0.023491917178034782, 0.021494247019290924, 0.0005228219670243561, -0.09578023105859756, 0.020698728039860725, -0.012416599318385124, 9.566904918756336e-05, -0.004413315560668707, -0.061761170625686646, -0.0637013390660286, 0.042515967041254044, -0.019275780767202377, -0.02194949984550476, 0.009037411771714687, 0.01570919342339039, 0.03664666786789894, -0.011252595111727715, 0.03090802952647209, -0.007981747388839722, -0.02050383761525154, 0.018466150388121605, 0.03974353149533272, -0.025002000853419304, 0.050263650715351105, 0.007021993398666382, 0.008837795816361904, 0.05353928357362747, -0.022880323231220245, -0.06497207283973694, 0.04554789885878563, -0.018929116427898407, -0.009569458663463593, 0.01566331833600998, -0.019115205854177475, -0.03303702920675278, 0.009130383841693401, -0.014804607257246971, -0.0005449571763165295, 0.03782359138131142, -0.024828260764479637, -0.02078486792743206, 0.0655641257762909, 0.05158458650112152, 0.02792096510529518, 0.021408189088106155, 0.01868128404021263, -0.00658809207379818, 0.04769236594438553, 0.011029918678104877, 0.022862408310174942, -0.1066974475979805, 0.017980752512812614, 0.060067128390073776, -0.020247258245944977, -0.013238530606031418, -0.0037571419961750507, -0.03314714878797531, 0.03496032953262329, 0.002900603460147977, 0.005402362905442715, -0.011998427100479603, -0.002979105804115534, -0.01913696900010109, -0.01963258534669876, 0.042408134788274765, -0.009021001867949963, -0.007898879237473011, -0.021550897508859634, -0.03288108482956886, -0.03879504278302193, -0.004414154216647148, -0.013777362182736397, 0.002389689441770315, 0.008905736729502678, 0.017035841941833496, 0.018444139510393143, -0.0013178084045648575, -0.039486613124608994, -0.041275616735219955, -0.011266754008829594, 0.020374281331896782, -0.03370968624949455, 0.000204631156520918, -0.009100602939724922, 0.0252525694668293, 0.03549852594733238, 0.03128744289278984, 0.014305423945188522, -0.0601888932287693, -0.014267995953559875, -0.025481728836894035, -0.020244712010025978, -0.02630830928683281, 0.03146608546376228, -0.0014750204281881452, 0.0024535346310585737, -0.0038783811032772064, -0.0765811875462532, 0.03446296975016594, -0.02106560207903385, -0.02600516565144062, -0.03663503751158714, -0.04224959760904312, 0.043299220502376556, 0.013586835004389286, 0.018750928342342377, 0.02581242099404335, 0.039144765585660934, -0.03560348600149155, -0.039731938391923904, -0.019383732229471207, 0.03881320357322693, -0.028673537075519562, -0.04575642570853233, -0.03004361502826214, -0.005910497158765793, 0.030279846861958504, -0.007141624577343464, 0.019756373018026352, -0.023295726627111435, -0.03364107385277748, 0.02890501730144024, -0.024780595675110817, 0.0008984562591649592, 0.06980859488248825, 0.020071787759661674, 0.029536670073866844, 0.011422575451433659, 0.04347628355026245, -0.06445597857236862, -0.01440176647156477, 0.014391300268471241, 0.0561925508081913, -0.024886617437005043, -0.04148561507463455, 0.03721332550048828, -0.06418784707784653, -0.004165216814726591, 0.0003651207953225821, -0.029715657234191895, -0.019475245848298073, 0.029696650803089142, -0.012616625986993313, -0.0030557524878531694, -0.0021627533715218306, -0.0742952898144722, 0.012262606993317604, -0.0001799284218577668, 0.012211686931550503, -0.025008374825119972, -0.018118908628821373, -0.051545578986406326, 0.012818536721169949, -0.04199879616498947, -0.011001648381352425, -0.03452016040682793, -0.048933450132608414, 0.026315126568078995, 0.04358910769224167, -0.025372887030243874, 0.013372916728258133, -0.015835797414183617, -0.01867358386516571, 0.00046081657637842, 0.14620473980903625, -0.02234949730336666, 0.0020660250447690487, 0.020974712446331978, 0.057302556931972504, 0.057796455919742584, -0.007015383802354336, -0.05949036404490471, -0.05624828487634659, 0.0719655454158783, 0.008784052915871143, 0.031273581087589264, -0.03282938897609711, -0.031061796471476555, -0.03810759261250496, -0.08086154609918594, -0.022178195416927338, 0.019675670191645622, 0.06560679525136948, -0.013616573065519333, -0.043210968375205994, 3.215650576748885e-05, 0.00761782331392169, 0.05968443304300308, 0.011839349754154682, -0.007775980047881603, -0.022673392668366432, 0.06027144193649292, 0.03070765547454357, 0.10095939040184021, -0.018273761495947838, 0.005221742205321789, -0.018574068322777748, 0.04666251316666603, -0.03984099254012108, 0.06332743912935257, 0.01782926544547081, -0.016721293330192566, 0.05946597829461098, 0.05359218269586563, 0.033750422298908234, 0.016198011115193367, -0.027816271409392357, -0.04610617086291313, 0.028852619230747223, 0.007923428900539875, -0.0038214283995330334, -0.024486064910888672, 0.016442378982901573, -0.014322064816951752, -0.01953463815152645, -0.022928450256586075, 0.0008578934939578176, -0.05842095986008644, -0.022136928513646126, 0.008564702235162258, 0.003413500264286995, 0.06435393542051315, -0.028461044654250145, -0.018981697037816048, -0.0038737014401704073, -0.01533331349492073, 0.03334103897213936, 0.0047195651568472385, 0.05163418874144554, 0.012878526002168655, 0.015777532011270523, -0.017106926068663597, -0.026351626962423325, -0.0024792684707790613, 0.02390154078602791, 0.0208142027258873, -0.007952270098030567, 0.02962517738342285, -0.09627814590930939, 0.04161230847239494, 0.014889301732182503, 0.0345672182738781, 0.02136984094977379, -0.0234579648822546, -0.0010088521521538496, 0.02120642364025116, 0.02020874246954918, 0.052654996514320374, -0.014558134600520134, -0.007277489174157381, -0.02099817618727684, -0.013605239801108837, 0.032453522086143494, -0.05961482226848602, -0.033378392457962036, 0.02022222988307476, 0.01256556436419487, -0.035198792815208435, -0.007077861577272415, -0.028356287628412247, -0.08278728276491165, 0.01319243386387825, 0.011490928009152412, -0.010274942964315414, 0.1108994409441948, 0.007383049000054598, -0.02479494735598564, 0.07341890782117844, -0.03335023671388626, -0.02382078766822815, -0.0029024509713053703, 0.002061470877379179, -0.005726231727749109, 0.024756118655204773, 0.05605892464518547, -0.1111818477511406, -0.021946679800748825, -0.01614011637866497, 0.04339047893881798, 0.0037102338392287493, -0.03505483642220497, 0.03899582847952843, 0.011435069143772125, 0.020221764221787453, -0.02669031172990799, 0.004832256119698286, -0.015849659219384193, -0.053173650056123734, 0.08263996988534927, -0.027410468086600304, 0.003806739579886198, 0.021086223423480988, 0.011895665898919106, 0.004174367990344763, -0.010561536997556686, -0.04180792719125748, -0.03417472541332245, -0.045226965099573135, 0.010197153314948082, -0.030837584286928177, -0.004010610748082399, -0.06798149645328522, -0.011551020666956902, 0.007941652089357376, -0.015609697438776493, 0.0025791102088987827, -0.015110041946172714, -0.00895458273589611, 0.020070506259799004, -0.03537007048726082, -0.056165747344493866, -0.002300521358847618, 0.024881338700652122, -0.008479470387101173, 0.031947214156389236, 0.04894424229860306, 0.021892020478844643, -0.03589446097612381, 0.032447777688503265, -0.0005914454814046621, 0.004301965236663818, 0.04572703316807747, -0.0488823801279068, -0.05986075475811958, 0.06363467872142792, -0.024566151201725006, -0.007733835838735104, -0.0016328251222148538, 0.002088487148284912, -0.041061803698539734, 0.06061312183737755, -0.021700792014598846, -0.06142508238554001, 0.028309062123298645, 0.04443175345659256, -0.02018892578780651, -0.003210728522390127, -0.006333168596029282, 0.05330387130379677, 0.03841035068035126, 0.023930702358484268, 0.07729266583919525, -0.0070358337834477425, 0.010095864534378052, 0.0035082155372947454, -0.04364701732993126, 0.01958599127829075, -0.027304809540510178, -0.038652773946523666, -0.008418343961238861, 0.01698392815887928, -0.08224364370107651, -0.003916551824659109, -0.03603890910744667, -0.002917617792263627, -0.017971839755773544, -0.019280605018138885, 0.030863644555211067, 0.04893184453248978, -0.009585131891071796, -0.08360493928194046, -0.02259354293346405, -0.01238773763179779, -0.01154390163719654, -0.03786724805831909, -0.06550996005535126, 0.035191889852285385, 0.041023921221494675, -0.0839797630906105, -0.017963111400604248, 0.0069897836074233055, -0.048476692289114, 0.015128010883927345, -0.04108655825257301, -0.012682551518082619, -0.006762385368347168, -0.0820191279053688, -0.02128656767308712, 0.015313138253986835, 0.07352937757968903, -0.03893899545073509, -0.015363140031695366, 0.00020186035544611514, 0.03244832530617714, -0.02580150030553341, 0.012067259289324284, 0.023155778646469116, 0.05740971863269806, 0.03198216110467911, 0.0014486911240965128, -0.007571084424853325, 0.0018173593562096357, -0.014613206498324871, -0.020077288150787354, -0.01991686038672924, 0.022061700001358986, -0.020931951701641083, -0.007911383174359798, -0.015219923108816147, 0.04887212812900543, -0.029203981161117554, -0.017386123538017273, 0.0005062524578534067, 0.01998247019946575, 0.03453019633889198, 0.03601843863725662, -0.022892383858561516, -0.03786938264966011, 0.01251247525215149, -0.02228088118135929, -0.06235315650701523, 0.033375006169080734, 0.02499912492930889, -0.0029817719478160143, -0.03126863017678261, 0.04454127326607704, -0.020727355033159256, -0.05043891444802284, 0.027192559093236923, 0.004596177488565445, 0.011618753895163536, -0.015578395687043667, -0.010279982350766659, 0.033704932779073715, 0.013912436552345753, -0.04848864674568176, -0.025850310921669006, 0.015299179591238499, 0.029496701434254646, 0.008933382108807564, 0.022771723568439484, 0.052512556314468384, -0.058724675327539444, -0.01635560765862465, 0.00438909325748682, -0.004956154152750969, -0.007998054847121239, -0.017453543841838837, -0.05093003809452057, -0.0351133868098259, -0.04187608137726784, -0.02981461212038994, -0.03136187791824341, 0.016929268836975098, 0.036952003836631775, 0.016865462064743042, 0.014302482828497887, 0.0077886562794446945, 0.016147229820489883, 0.000838114763610065, 0.03724339231848717, 0.028707200661301613, 0.03142758086323738, 0.021611131727695465, 0.021806767210364342, 0.047581709921360016, -0.027289913967251778, -0.022526979446411133, 0.022611679509282112, 0.020773418247699738, -0.04105991870164871, -0.007196064572781324, -0.03604194521903992, -0.019560659304261208, 0.037935853004455566, 0.033026669174432755, -0.005511774681508541, 0.021567655727267265, -0.03302362561225891, 0.03061603009700775, -0.013104689307510853, -0.02195853739976883, 0.0036418400704860687, 0.029302651062607765, 0.03702777996659279, -0.023991437628865242, -0.013686315156519413, 0.0018302926328033209, 0.019493216648697853, -0.030949236825108528, -0.021212460473179817, -0.016473721712827682, 0.01122590247541666, 0.0306366179138422, -0.006342783570289612, 0.027236908674240112, -0.02128228172659874, -0.014434566721320152, -0.01231425441801548, -0.00016167025023605675, -0.0018798656528815627, 0.052097540348768234, -0.03532586246728897, -0.06617746502161026, 0.03259539231657982, -0.01406063698232174, 0.06100107356905937, 0.07049666345119476, -0.006168816238641739, 0.005293144378811121, -0.05009221285581589, -0.03336139768362045, -0.015566766262054443, 0.02927062101662159, -0.013397573493421078, -0.03303980082273483, 0.0014945641160011292, 0.007068014238029718, -0.01438180822879076, 0.021002979949116707, 0.04071946069598198, -0.038102857768535614, 0.03645922616124153, -0.01619100198149681, 0.009750714525580406, 0.0431421734392643, 0.03573150187730789, 0.03532516583800316, -0.01626201719045639, -0.019360437989234924, -0.013567009940743446, -0.024645064026117325, 0.05361149460077286, -0.00853391457349062, 0.04902370274066925, 0.0243704691529274, 0.04396417737007141, -0.014774011448025703, -0.010160966776311398, -0.05355997383594513, 0.006330398842692375, -0.040334030985832214, 0.022206775844097137, -0.0013751523802056909, -0.03988051787018776, -0.06964970380067825, 0.00015012602671049535, -0.0005040825926698744, 0.06797172874212265, 0.038351401686668396, 0.0782804787158966, 0.02200876735150814, 0.005389373283833265, 0.017445188015699387, 0.00010459344775881618, 0.02805521711707115, 0.031835149973630905, 0.014127430506050587, -0.045648206025362015, -0.0499076284468174, -0.010870427824556828, 0.005909311585128307, 0.047743894159793854, 0.005949078593403101, -0.009914547204971313, -0.05552612245082855, -0.017545802518725395, -0.008860071189701557, -0.041030947118997574, -0.05164513364434242, 0.012700822204351425, 0.06362907588481903, -0.02331584319472313, 0.013669309206306934, 0.016287047415971756, 0.2864297926425934, -0.029474962502717972, 0.010040802881121635, -0.0447385311126709, 0.03887912631034851, 0.006894007325172424, 0.022399257868528366, -0.0007777963182888925, -0.015402178280055523, 0.00022745711612515152, 0.0025212266482412815, 0.012183412909507751, 0.03795034810900688, -0.039392970502376556, 0.0036947820335626602, 0.008819245733320713, 0.01187855750322342, -0.0031687889713793993, 0.014764898456633091, 0.02646554261445999, 0.005468165967613459, -0.014688621275126934, 0.010408908128738403, -0.0008929487084969878, 0.031062856316566467, 0.005883822683244944, 0.0022633690387010574, 0.03287532180547714, -0.021614346653223038, 0.061867572367191315, 0.03122795931994915, -0.014700397849082947, 0.043684229254722595, -0.0021617445163428783, 0.004687670152634382, -0.03353726491332054, -0.018313053995370865, 0.01288652140647173, -0.017576569691300392, 0.013265063054859638, 0.016103127971291542, 0.008023999631404877, -0.04410070180892944, -0.009516901336610317, 0.02651204541325569, -0.045305293053388596, 0.0014347254764288664, 0.0005016960785724223, -0.01901644468307495, -0.03256054222583771, -0.06451266258955002, 0.025237534195184708, -0.03076220490038395, -0.010278893634676933, -0.025683125481009483, 0.000995784648694098, 0.0017538575921207666, -0.04831398278474808, -0.024519704282283783, 0.06815529614686966, -0.024713274091482162, 0.04403967410326004, 0.0026243890170007944, -0.020195715129375458, 0.025076065212488174, 0.013134380802512169, 0.03032144531607628, 0.043851159512996674, -0.018431145697832108, -0.0738498792052269, -0.03507036343216896, -0.053929805755615234, -0.008397707715630531]
    


```python
# This code snippet is creating a list called `embeddings` by applying the function `embed_chunk` to each element in the list `chunks`.
embeddings = [embed_chunk(chunk) for chunk in chunks]

print(len(embeddings))
print(embeddings[0])
```

    9
    [0.014284647069871426, 0.018255915492773056, -0.005742250010371208, 0.017133180052042007, 0.048848479986190796, -0.09815548360347748, 0.011178532615303993, -0.024779485538601875, -0.009087535552680492, -0.002999982563778758, -0.042500805109739304, 0.002114951377734542, -0.02906540408730507, 0.029346996918320656, -0.04750559851527214, 0.010298887267708778, 0.006046853493899107, 0.006340973544865847, -0.04148385301232338, 0.026497025042772293, 0.005674091167747974, 0.005881955847144127, 0.00840919092297554, 0.007991339080035686, -0.0015357709489762783, -0.0471574068069458, -0.015852216631174088, 0.036133602261543274, 0.014721675775945187, 0.0506136454641819, 0.01709485799074173, 0.035577669739723206, -0.049689192324876785, -0.004296205006539822, -0.0001784434134606272, 0.0036810452584177256, 0.013953663408756256, 0.0003661700466182083, 0.002759318333119154, 0.024674158543348312, -0.032023802399635315, 0.005019265692681074, -0.0075476872734725475, -0.08371433615684509, -0.02911788783967495, 0.030661441385746002, 0.04018634557723999, 0.029331624507904053, -0.027243290096521378, 0.033614952117204666, -0.061250872910022736, 0.513512372970581, 0.021306712180376053, -0.021793648600578308, -0.01881222426891327, 0.01781344786286354, -0.0014097231905907393, -0.02324335090816021, 0.008617828600108624, -0.012666232883930206, 0.032932884991168976, -0.009352232329547405, -0.01615397445857525, 0.0168062262237072, 0.02325333096086979, -0.023916704580187798, -0.018078230321407318, -0.03891335055232048, -0.07533659040927887, 0.001026022364385426, 0.026415487751364708, 0.005092157516628504, -0.013343562372028828, 0.03575950115919113, 0.06532783806324005, 0.013842557556927204, 0.009876827709376812, -0.0027035388629883528, 0.016971830278635025, 0.03295574709773064, 0.010363131761550903, -0.0366443507373333, 0.03494049236178398, -0.04463552311062813, -0.005035401787608862, 0.012348471209406853, 0.010975142940878868, -0.03781870752573013, 0.014703559689223766, -0.037957314401865005, -0.034654777497053146, -0.009864205494523048, -0.04238950461149216, 0.05197596549987793, -0.005160972010344267, 0.006514897570014, 0.03689490631222725, 0.008093640208244324, -0.04386066645383835, 0.029255954548716545, 0.025808464735746384, -0.02228568121790886, -0.05691605061292648, -0.007293343544006348, 0.014629225246608257, -0.0024331207387149334, -0.00736193684861064, 0.03662971407175064, 0.001523745944723487, -0.0022441300097852945, 0.016043955460190773, -0.04261111840605736, 0.04267820343375206, 0.02887621894478798, 0.0002544604940339923, 0.004184280522167683, -0.008228198625147343, 0.01406799629330635, 0.003962378948926926, 0.03611084818840027, 0.006184686440974474, 0.030144667252898216, 0.010403384454548359, 0.00556077528744936, -0.018431417644023895, -0.014576608315110207, 0.03337814286351204, 0.0086141899228096, -0.014901438727974892, 0.056921228766441345, -0.000976390263531357, -0.00768265500664711, -0.07287328690290451, -0.01594209298491478, -0.0032658306881785393, -0.013257031328976154, -0.02369585633277893, -0.022182220593094826, -0.019241420552134514, -0.08166876435279846, 0.05829252675175667, -0.051171932369470596, 0.006769378203898668, 0.022598810493946075, -0.0031706951558589935, 0.03580862283706665, 0.007618126459419727, 0.04362323135137558, 0.06057090684771538, -0.04426809772849083, 0.01688765361905098, -0.029834285378456116, -0.019717665389180183, 0.05125726759433746, 0.021500637754797935, 0.018387239426374435, -0.023867292329669, -0.018584908917546272, -0.02662692777812481, 0.017354348674416542, -0.0043826038017869, 0.020285066217184067, -0.002818996086716652, 0.03822983428835869, 0.018792595714330673, -0.0008637142600491643, -0.004348802380263805, 0.02013360522687435, 0.05117223784327507, -0.00109588960185647, -0.011268419213593006, 0.0274706669151783, -0.0011166033800691366, -0.010976862162351608, -0.029682373628020287, -0.024825459346175194, 0.007074638269841671, 0.004286917392164469, -0.05032904073596001, -0.026252130046486855, -0.04450518637895584, -0.006520853377878666, -0.018129538744688034, -0.004068740177899599, -0.0025374412070959806, 0.0027393819764256477, -0.008824163116514683, -0.014004694297909737, 0.01503956038504839, 0.029115727171301842, 0.01899954490363598, -0.0036245144437998533, -0.020581314340233803, -0.03964878246188164, 0.041080351918935776, 0.019272170960903168, 0.00902468990534544, -0.0018192395800724626, -0.03386250510811806, -0.026754381135106087, -0.033390630036592484, 0.02097444422543049, -0.0012129292590543628, -0.019248055294156075, 0.0064839827828109264, 0.02564574033021927, -0.024464290589094162, -0.021044449880719185, 0.04064224287867546, -0.03177095204591751, 0.0028528531547635794, -0.024895470589399338, -0.005286762025207281, 0.02223973348736763, 0.05699408799409866, 0.0017264814814552665, -0.014937717467546463, -0.010843010619282722, 0.0014854533364996314, 0.00568436598405242, -0.004339006729424, -0.04759638011455536, -0.004517438355833292, 0.021673301234841347, 0.003856417490169406, 0.004070686176419258, 0.029383625835180283, 0.0009631494176574051, -0.026450196281075478, 0.015562931075692177, -0.04806608334183693, -0.004236516542732716, -0.06969860941171646, -0.041374918073415756, -0.012144085019826889, -0.03397756442427635, -0.029704604297876358, 0.022842682898044586, -0.04204907268285751, -0.062441691756248474, 0.04781971871852875, 0.0030400482937693596, -0.028030792251229286, -0.024730555713176727, 0.026862502098083496, 0.007350059226155281, 0.008858938701450825, 0.013182590715587139, 0.011576877906918526, 0.01619260385632515, 0.021456731483340263, -0.03399332985281944, -0.011212683282792568, -0.007781446445733309, 0.02853727899491787, 0.06723892688751221, 0.019774343818426132, -0.05435776337981224, 0.029435325413942337, 0.0012341918190941215, 0.006436701864004135, -0.01704593002796173, 0.030775215476751328, 0.015351937152445316, -0.009266157634556293, 0.004091387614607811, -0.02968226931989193, -0.062126174569129944, -0.019611218944191933, -0.0005564584280364215, 0.028982220217585564, 0.04698644205927849, 0.014066246338188648, -0.008318529464304447, 0.011407283134758472, -0.004216418601572514, 0.0012282941024750471, -0.0008852398605085909, -0.03416173905134201, -0.03029528260231018, -0.012602866627275944, 0.02491150051355362, 0.019260700792074203, -0.021771494299173355, -0.023622723296284676, -0.011034676805138588, -0.01000006590038538, 0.05051208660006523, -0.01839001476764679, 0.005595753435045481, 0.020212575793266296, -0.005195800215005875, 0.04063896834850311, -0.0030375001952052116, 0.02065485343337059, -0.00658536097034812, 0.018067853525280952, -0.01975787617266178, 0.05966087058186531, -0.021332254633307457, 0.00829096045345068, -0.009726367890834808, -0.06715710461139679, 0.06678912043571472, -0.04498470947146416, 0.020456446334719658, 0.040823254734277725, 0.05494687333703041, 0.003931587561964989, -0.010241338051855564, -0.00971541553735733, 0.04565081000328064, 0.04715433716773987, -0.008479597978293896, 0.04165685549378395, 0.044799599796533585, -0.042296189814805984, 0.0072495401836931705, 0.03344648703932762, 0.03178076073527336, -0.007089294493198395, 0.0525120310485363, 0.03410475701093674, 0.07540906965732574, 0.013576892204582691, -0.005130853038281202, 0.0052149007096886635, -0.0532701313495636, -0.0005430395831353962, 0.019601138308644295, 0.02955853007733822, -0.01657348871231079, 0.025467151775956154, 0.017251508310437202, 0.0004109847650397569, 0.02993551269173622, -0.00143930793274194, -0.0017136227106675506, 0.01956944540143013, -0.03212433680891991, -0.0006491715321317315, 0.02747463807463646, -0.028678011149168015, -0.01473141647875309, -0.0076732635498046875, 0.005957813002169132, 0.06891293823719025, -0.02696574479341507, -0.044355761259794235, -0.005874902941286564, -0.029804904013872147, 0.06445059925317764, 0.03030790388584137, -0.06434324383735657, 0.003070663660764694, -0.004448250867426395, 0.030916960909962654, -0.016069669276475906, 0.03134677931666374, -0.007155829109251499, -0.0178544782102108, -0.0016996446065604687, 0.007630134467035532, 0.0200575552880764, 0.01664027012884617, -0.01737118698656559, 0.010404018685221672, -0.0009398136171512306, -0.06402476131916046, -0.033038463443517685, 0.02074355073273182, 0.04118141159415245, -0.05623806267976761, -0.010169698856770992, 0.0049149817787110806, 0.03893737122416496, 0.023746369406580925, 0.016457336023449898, -0.004190187901258469, -0.009597770869731903, 0.030932284891605377, -0.01032829936593771, 0.010992759838700294, -0.07247482240200043, 0.00022854804410599172, -0.013130784034729004, -0.013251528143882751, -0.03960297256708145, -0.04769093543291092, -0.029189512133598328, 0.0005743924411945045, -0.010358046740293503, -0.0012230239808559418, -0.022789638489484787, -0.04329768568277359, 0.023302070796489716, -0.03816763311624527, 0.0036476352252066135, 0.021160315722227097, 0.06380859017372131, -0.004000557586550713, -0.010881254449486732, -0.0228574238717556, -0.03221261873841286, 0.0012917359126731753, -0.03662622720003128, 0.020325208082795143, -0.010007355362176895, 0.053869716823101044, -0.03000819683074951, -0.0802239179611206, 0.04392745718359947, -0.02468847669661045, -0.026894405484199524, -0.0394008494913578, -0.018749520182609558, 0.004543954972177744, -0.0052814544178545475, 0.014863356947898865, -0.014503172598779202, -0.01571480929851532, -0.01762906275689602, 0.007937692105770111, 0.005308517254889011, -0.011528540402650833, 0.029753737151622772, -0.016185592859983444, -0.00805903971195221, -0.012294566258788109, -0.030714044347405434, 0.00942457839846611, -0.030489977449178696, -0.030550407245755196, -0.017884401604533195, -0.0015890373615548015, -0.06603807210922241, -0.021342402324080467, -0.007362223695963621, 0.026595933362841606, 0.036970511078834534, -0.027537930756807327, -0.0005289571126922965, 0.042947735637426376, 0.023970847949385643, 0.06079202517867088, -0.012391319498419762, 0.01804247498512268, -0.00439814617857337, 0.03548713028430939, 0.04754827544093132, 0.005388833582401276, -0.02765559032559395, -0.01623489335179329, -0.015020344406366348, 0.02530122734606266, -0.0213971845805645, 0.024732988327741623, -0.023621411994099617, 0.06756104528903961, 0.042019765824079514, -0.006322586443275213, 0.007273355033248663, 0.045554712414741516, -0.005087622907012701, 0.015397503972053528, 0.028484592214226723, 0.0260038860142231, 0.013463827781379223, -0.015526444651186466, 0.05094972625374794, 0.027774838730692863, 0.0061676716431975365, -0.011894810944795609, -0.01063111424446106, 0.021731263026595116, -0.027119619771838188, -0.027922943234443665, -0.017107920721173286, -0.05848116800189018, -0.03398194536566734, 0.021388579159975052, -0.006916975136846304, 0.0017428180435672402, 0.011399366892874241, 0.0001134721387643367, 0.042561888694763184, 0.02364344336092472, -0.0395953394472599, -0.00021024429588578641, -0.003845596918836236, 0.02592349983751774, -0.06095627322793007, 0.0338246151804924, 0.03063652105629444, 0.005662810523062944, -0.07360723614692688, 0.010324379429221153, -0.018194951117038727, -0.03020223043859005, -0.036707766354084015, -0.0023741761688143015, -0.06846954673528671, 0.05484146624803543, 0.02056199125945568, -0.028323283419013023, -0.08072531968355179, -0.07806086540222168, 0.01810716651380062, -0.033206772059202194, -0.005436975043267012, 0.03559871017932892, 0.053949274122714996, 0.016287852078676224, -0.02388707362115383, 0.06779592484235764, 0.04072362184524536, -0.01227347832173109, -0.03172803670167923, -3.278950316598639e-05, -0.01903051882982254, 0.007314973510801792, -0.01580088771879673, -0.024129752069711685, 0.006583582144230604, -0.026652583852410316, 0.03591306880116463, -0.018581198528409004, 0.012747829779982567, -0.00261135958135128, 0.02160661481320858, 0.008179823867976665, 0.010840052738785744, -0.02761063352227211, -0.027014365419745445, 0.024621963500976562, 0.0177613478153944, 0.012481573969125748, -0.00615202309563756, 0.01914294995367527, 0.02699342928826809, -0.0017993745859712362, -0.003974999766796827, -0.016384923830628395, -0.019158272072672844, -0.01659434288740158, -0.003120041685178876, -0.0025286159943789244, -0.013637482188642025, -0.0065903798677027225, -0.06372428685426712, -0.03839133307337761, -0.0035751420073211193, 0.008689305745065212, -0.005511299706995487, 0.028255797922611237, 0.031102841719985008, -0.05347144976258278, -0.02689138799905777, 0.0521048903465271, 0.032803378999233246, -0.007631611544638872, -0.04736962914466858, 0.012940430082380772, -0.04255248233675957, -0.014300968497991562, -0.008826608769595623, -0.040611378848552704, -0.055522553622722626, -0.056206777691841125, 0.011504760943353176, 0.03216962516307831, 0.005498640239238739, 0.03183038905262947, 0.025047697126865387, 0.002510185120627284, 0.019420133903622627, 0.02735188975930214, -0.028739921748638153, -0.0018153595738112926, -0.03558247536420822, -0.011715580709278584, 0.0033661616034805775, 0.02546771802008152, -0.02613675966858864, 0.005615787114948034, -0.012645266950130463, -0.007809551898390055, -0.017805198207497597, -0.034112874418497086, -0.040566619485616684, -0.013182283379137516, 0.002076203003525734, 0.008507329039275646, 0.01958596147596836, 0.041251976042985916, 0.01569974422454834, -0.044725678861141205, 0.02769429236650467, 0.002050457987934351, 0.054022982716560364, 0.04097506031394005, 0.04096383973956108, 0.0047788419760763645, -0.05520918220281601, -0.019852986559271812, -0.06585221737623215, 0.00676618842408061, -0.005078732036054134, 0.009143241681158543, -0.030707955360412598, -0.08500993996858597, 0.020711461082100868, -0.025251805782318115, 0.024975765496492386, 0.004288999829441309, 0.03690487891435623, 0.006772809661924839, -0.005354604218155146, -0.019179871305823326, -0.052410200238227844, 0.01875823736190796, -0.0024964623153209686, 0.02052559144794941, 0.04666338860988617, -0.0009548262460157275, -0.04850642755627632, -0.00637519545853138, 0.06669667363166809, 0.012316012755036354, 0.001581254880875349, -0.03209291025996208, 0.020845437422394753, 0.07738646864891052, 0.005607751198112965, -0.021887164562940598, 0.005167434923350811, -0.005416106432676315, -0.015489667654037476, 0.02951883338391781, 0.040212880820035934, 0.08488626033067703, -0.004511700477451086, 0.013137442991137505, 0.022824523970484734, 0.03292259946465492, -0.020077919587492943, -0.02950652875006199, 0.02979959174990654, -0.00933130457997322, -0.01540293637663126, 0.015925223007798195, -0.009747479110956192, 0.032759688794612885, 0.020534634590148926, 0.03644947707653046, -0.046819936484098434, 0.05779007077217102, -0.010483015328645706, -0.047200512140989304, 0.024314334616065025, 0.01601511612534523, 0.02533312700688839, -0.002932487055659294, -0.10959412902593613, -0.010173294693231583, -0.08918865770101547, -0.012709618546068668, 0.02605319954454899, -0.01746038720011711, 0.027357712388038635, 0.03135668858885765, 0.04917658120393753, 0.005078319925814867, -0.015106323175132275, -0.010807656683027744, 0.02217940241098404, 0.006901255343109369, 0.0023518467787653208, 0.0018851680215448141, -0.017822662368416786, -0.04704247787594795, 0.017120076343417168, 0.005426028277724981, -0.03580819442868233, -0.02426893636584282, 0.009013284929096699, -0.05532573536038399, -0.03653279319405556, 0.0479307658970356, -0.01126051601022482, -0.0014416329795494676, 0.0020560496486723423, 0.012487065978348255, -0.014849664643406868, 0.08315891772508621, 0.13644297420978546, -0.021750852465629578, -0.043014608323574066, 0.004365737084299326, 0.027245448902249336, -0.009805439040064812, 0.0009236425394192338, 0.017442679032683372, -0.06658902019262314, 0.008037663996219635, -0.03451664000749588, -0.011267026886343956, -0.0902140662074089, -0.0304807648062706, 0.020589616149663925, -0.045816753059625626, 0.03838549926877022, -0.01893661916255951, 0.03562319651246071, 0.029863128438591957, -0.000733919208869338, 0.038997404277324677, 0.024344678968191147, 0.010287808254361153, 0.017686909064650536, -0.025124603882431984, -0.006362309213727713, -0.0008782813092693686, 0.030583029612898827, 0.04946933686733246, -0.014544881880283356, -0.009831580333411694, 0.03994528204202652, -0.005547332111746073, -0.047169532626867294, 0.03671177849173546, 0.04175027459859848, -0.009564000181853771, -0.03985491022467613, -0.05302142724394798, 0.009354596957564354, 0.00527057982981205, 0.10418422520160675, -0.04321880266070366, -0.006072678603231907, -0.03833475336432457, -0.03472235053777695, -0.001484756707213819, 0.0035346350632607937, -0.023911235854029655, 0.020207706838846207, -0.002754153683781624, 0.012146072462201118, -0.04121315851807594, 0.02143445983529091, -0.05024562031030655, -0.04299640282988548, 0.0027370627503842115, 0.003807994071394205, 0.020288772881031036, -0.029220134019851685, 0.07483518123626709, -0.016961388289928436, 0.003221847815439105, -0.03388737514615059, -0.030300911515951157, -0.008884179405868053, 0.053552210330963135, 0.019903702661395073, -0.01600499637424946, -0.006269366014748812, -0.027409840375185013, -0.0019832667894661427]
    


```python
# This code snippet is using the `chromadb` library to save embeddings associated with chunks of data into a database collection. Here's a breakdown of what the code is doing:
# %pip install chromadb
import chromadb

chromadb_client = chromadb.EphemeralClient()
chromadb_collection = chromadb_client.get_or_create_collection(name="default")

def save_embeddings(chunks: List[str], embeddings: List[List[float]]) -> None:
    for i, (chunk, embedding) in enumerate(zip(chunks, embeddings)):
        chromadb_collection.add(
            documents=[chunk],
            embeddings=[embedding],
            ids=[str(i)]
        )

save_embeddings(chunks, embeddings)
```


```python
# This code snippet defines a function named `retrieve` that takes a query string and a top_k integer as input parameters. Inside the function, it embeds the query using the `embed_chunk` function, queries a collection named `chromadb_collection` with the embedded query, and retrieves the top k results. Finally, it returns the first document from the retrieved results.
def retrieve(query: str, top_k: int) -> List[str]:
    query_embedding = embed_chunk(query)
    results = chromadb_collection.query(
        query_embeddings=[query_embedding],
        n_results=top_k
    )
    return results['documents'][0]

query = "哆啦A梦使用的3个秘密道具分别是什么？"
retrieved_chunks = retrieve(query, 5)

for i, chunk in enumerate(retrieved_chunks):
    print(f"[{i}] {chunk}\n")
```

    [0] 三件秘密道具分别是：可以临时赋予超级战力的“复制斗篷”，能暂停时间五秒的“时间停止手表”，以及可在一分钟中完成一年修行的“精神与时光屋便携版”。大雄被推进精神屋内，在其中接受密集的训练，虽然只有几分钟现实时间，他却经历了整整一年的苦修。刚开始他依旧软弱，想放弃、想逃跑，但当他想起静香、父母，还有哆啦A梦那坚定的眼神时，他终于咬牙坚持了下来。出来之后，他的身体与精神都焕然一新，眼神中多了一份成熟与自信。
    
    [1] 最终战在黑暗赛亚人的空中要塞前爆发，特兰克斯率先出击，释放全力与敌人正面对决。哆啦A梦则用任意门和道具支援，从各个方向制造混乱，尽量压制敌人的时空能力。但黑暗赛亚人太过强大，仅凭特兰克斯一人根本无法压制，更别说击败。就在特兰克斯即将被击倒之际，大雄披上复制斗篷、冲破恐惧从高空跃下。他的拳头燃烧着金色光焰，目标直指敌人心脏。
    
    [2] 战后，未来世界开始恢复，植物重新生长，人类重建家园。特兰克斯告别时紧紧握住大雄的手，说：“你是我见过最特别的战士。”哆啦A梦也为大雄感到骄傲，说他终于真正成长了一次。三人站在山丘上，看着远方重新明亮的地平线，心中感受到从未有过的安宁。随后，哆啦A梦与大雄乘坐时光机返回了属于他们的那个年代，一切仿佛又恢复平静。
    
    [3] 哆啦A梦与超级赛亚人：时空之战
    在一个寻常的午后，大雄依旧坐在书桌前发呆，作业堆得像山，连第一页都没动。哆啦A梦在一旁翻着漫画，时不时叹口气，觉得这孩子还是一如既往的不靠谱。正当他们的生活照常进行时，一道强光突然从天而降，整个房间震动不已。光芒中走出一名金发少年，身披战甲、气势惊人，他就是来自未来的超级赛亚人——特兰克斯。他一出现便说出了惊人的话：未来的地球即将被黑暗势力摧毁，他来此是为了寻求哆啦A梦的帮助。
    
    [4] 哆啦A梦与大雄听后大惊，但也从特兰克斯坚定的眼神中读出了不容拒绝的决心。特兰克斯解释说，未来的敌人并非普通反派，而是一个名叫“黑暗赛亚人”的存在，他由邪恶科学家复制了贝吉塔的基因并加以改造，实力超乎想象。这个敌人不仅拥有赛亚人战斗力，还能操纵扭曲的时间能量，几乎无人可敌。特兰克斯已经独自战斗多年，但每一次都以惨败告终。他说：“科技，是我那个时代唯一缺失的武器，而你们，正好拥有它。”
    
    


```python
# This code snippet is performing a reranking task using a CrossEncoder model from the `sentence_transformers` library. Here's a breakdown of what the code is doing:
from sentence_transformers import CrossEncoder

def rerank(query: str, retrieved_chunks: List[str], top_k: int) -> List[str]:
    cross_encoder = CrossEncoder('cross-encoder/mmarco-mMiniLMv2-L12-H384-v1')
    pairs = [(query, chunk) for chunk in retrieved_chunks]
    scores = cross_encoder.predict(pairs)

    scored_chunks = list(zip(retrieved_chunks, scores))
    scored_chunks.sort(key=lambda x: x[1], reverse=True)

    return [chunk for chunk, _ in scored_chunks][:top_k]

reranked_chunks = rerank(query, retrieved_chunks, 3)

for i, chunk in enumerate(reranked_chunks):
    print(f"[{i}] {chunk}\n")
```

    [0] 三件秘密道具分别是：可以临时赋予超级战力的“复制斗篷”，能暂停时间五秒的“时间停止手表”，以及可在一分钟中完成一年修行的“精神与时光屋便携版”。大雄被推进精神屋内，在其中接受密集的训练，虽然只有几分钟现实时间，他却经历了整整一年的苦修。刚开始他依旧软弱，想放弃、想逃跑，但当他想起静香、父母，还有哆啦A梦那坚定的眼神时，他终于咬牙坚持了下来。出来之后，他的身体与精神都焕然一新，眼神中多了一份成熟与自信。
    
    [1] 最终战在黑暗赛亚人的空中要塞前爆发，特兰克斯率先出击，释放全力与敌人正面对决。哆啦A梦则用任意门和道具支援，从各个方向制造混乱，尽量压制敌人的时空能力。但黑暗赛亚人太过强大，仅凭特兰克斯一人根本无法压制，更别说击败。就在特兰克斯即将被击倒之际，大雄披上复制斗篷、冲破恐惧从高空跃下。他的拳头燃烧着金色光焰，目标直指敌人心脏。
    
    [2] 战后，未来世界开始恢复，植物重新生长，人类重建家园。特兰克斯告别时紧紧握住大雄的手，说：“你是我见过最特别的战士。”哆啦A梦也为大雄感到骄傲，说他终于真正成长了一次。三人站在山丘上，看着远方重新明亮的地平线，心中感受到从未有过的安宁。随后，哆啦A梦与大雄乘坐时光机返回了属于他们的那个年代，一切仿佛又恢复平静。
    
    


```python
# Cell: Replace Google Generative AI with Ollama for generation

import requests
from typing import List, Optional

def install_and_check_ollama():
    """Check if Ollama is installed and running, provide installation instructions if not."""
    try:
        response = requests.get("http://localhost:11434/api/tags", timeout=5)
        if response.status_code == 200:
            models = response.json().get('models', [])
            print(f"Ollama is running with {len(models)} models available:")
            for model in models:
                print(f"  - {model['name']}")
            return True
        else:
            print("Ollama server is not responding properly.")
            return False
    except requests.exceptions.RequestException:
        print("Ollama is not running or not installed.")
        print("\nTo install Ollama:")
        print("1. Visit: https://ollama.com/download")
        print("2. Or run: curl -fsSL https://ollama.com/install.sh | sh (Linux)")
        print("3. Start Ollama: ollama serve")
        print("4. Pull a Chinese model: ollama pull qwen2.5:7b")
        return False

def ensure_chinese_model():
    """Ensure a suitable Chinese language model is available."""
    try:
        response = requests.get("http://localhost:11434/api/tags")
        models = response.json().get('models', [])
        model_names = [model['name'] for model in models]
        chinese_models = [
            'qwen2.5:7b',
            'qwen2.5:3b',
            'qwen2.5:14b',
            'llama3.2:3b',
            'gemma2:9b'
        ]
        for model in chinese_models:
            if any(model in name for name in model_names):
                print(f"Found suitable model: {model}")
                return model
        print("No suitable Chinese model found.")
        print("Recommended: Run 'ollama pull qwen2.5:7b' to install a Chinese-capable model")
        return None
    except Exception as e:
        print(f"Error checking models: {e}")
        return None

def generate_with_ollama(query: str, chunks: List[str], model: Optional[str] = None, num_answers: int = 3) -> List[str]:
    """
    Generate multiple answers using Ollama local LLM.
    Args:
        query: User's question
        chunks: Retrieved and reranked text chunks
        model: Ollama model name (auto-detected if None)
        num_answers: Number of answers to generate
    Returns:
        List of generated response texts
    """
    if model is None:
        model = ensure_chinese_model()
        if model is None:
            return ["Error: No suitable Chinese model available. Please install a model first."]
    prompt = f"""你是一位专业的知识助手。请根据用户的问题和提供的相关文档片段，生成{num_answers}个不同但合理的回答，每个回答用数字序号分隔。

用户问题: {query}

相关文档片段:
{chr(10).join(f"片段{i+1}: {chunk}" for i, chunk in enumerate(chunks))}

请基于以上内容回答用户的问题。要求：
1. 每个回答要准确且基于提供的文档内容
2. 如果文档中没有相关信息，请明确说明
3. 回答要详细完整，条理清晰
4. 使用中文回答
5. 每个回答前请用“1.”、“2.”、“3.”编号
"""
    print(f"Prompt sent to Ollama:\n{prompt}\n{'='*50}\n")
    try:
        payload = {
            "model": model,
            "prompt": prompt,
            "stream": False,
            "options": {
                "temperature": 0.7,
                "top_p": 0.9,
                "top_k": 40,
                "num_predict": 1500,
                "stop": ["用户问题:", "相关文档片段:"]
            }
        }
        response = requests.post(
            "http://localhost:11434/api/generate",
            json=payload,
            timeout=120
        )
        if response.status_code == 200:
            result = response.json()
            generated_text = result.get('response', '').strip()
            if generated_text:
                # Split answers by numbered list (e.g., "1.", "2.", "3.")
                import re
                answers = re.split(r"\n\d\.", "\n" + generated_text)
                answers = [ans.strip() for ans in answers if ans.strip()]
                # If not split, fallback to whole text
                if len(answers) < num_answers:
                    answers = [generated_text]
                return answers[:num_answers]
            else:
                return ["Error: Empty response from model"]
        else:
            return [f"Error: Ollama request failed with status {response.status_code}: {response.text}"]
    except requests.exceptions.Timeout:
        return ["Error: Request timed out. The model might be too large or the query too complex."]
    except requests.exceptions.RequestException as e:
        return [f"Error: Network request failed: {e}"]
    except Exception as e:
        return [f"Error: Unexpected error occurred: {e}"]

print("Checking Ollama installation and status...")
if install_and_check_ollama():
    if 'query' in globals() and 'reranked_chunks' in globals():
        print("\nGenerating 3 answers using Ollama...")
        answers = generate_with_ollama(query, reranked_chunks, num_answers=3)
        print(f"\nGenerated Answers: {answers}\n")
        # for idx, ans in enumerate(answers, 1):
        #     print(f"{idx}. {ans}\n")
    else:
        print("Variables 'query' and 'reranked_chunks' not found. Please run previous cells first.")
else:
    print("Please install and start Ollama first, then run this cell again.")
```

    Checking Ollama installation and status...
    Ollama is running with 1 models available:
      - qwen2.5:7b
    
    Generating 3 answers using Ollama...
    Found suitable model: qwen2.5:7b
    Prompt sent to Ollama:
    你是一位专业的知识助手。请根据用户的问题和提供的相关文档片段，生成3个不同但合理的回答，每个回答用数字序号分隔。
    
    用户问题: 哆啦A梦使用的3个秘密道具分别是什么？
    
    相关文档片段:
    片段1: 三件秘密道具分别是：可以临时赋予超级战力的“复制斗篷”，能暂停时间五秒的“时间停止手表”，以及可在一分钟中完成一年修行的“精神与时光屋便携版”。大雄被推进精神屋内，在其中接受密集的训练，虽然只有几分钟现实时间，他却经历了整整一年的苦修。刚开始他依旧软弱，想放弃、想逃跑，但当他想起静香、父母，还有哆啦A梦那坚定的眼神时，他终于咬牙坚持了下来。出来之后，他的身体与精神都焕然一新，眼神中多了一份成熟与自信。
    片段2: 最终战在黑暗赛亚人的空中要塞前爆发，特兰克斯率先出击，释放全力与敌人正面对决。哆啦A梦则用任意门和道具支援，从各个方向制造混乱，尽量压制敌人的时空能力。但黑暗赛亚人太过强大，仅凭特兰克斯一人根本无法压制，更别说击败。就在特兰克斯即将被击倒之际，大雄披上复制斗篷、冲破恐惧从高空跃下。他的拳头燃烧着金色光焰，目标直指敌人心脏。
    片段3: 战后，未来世界开始恢复，植物重新生长，人类重建家园。特兰克斯告别时紧紧握住大雄的手，说：“你是我见过最特别的战士。”哆啦A梦也为大雄感到骄傲，说他终于真正成长了一次。三人站在山丘上，看着远方重新明亮的地平线，心中感受到从未有过的安宁。随后，哆啦A梦与大雄乘坐时光机返回了属于他们的那个年代，一切仿佛又恢复平静。
    
    请基于以上内容回答用户的问题。要求：
    1. 每个回答要准确且基于提供的文档内容
    2. 如果文档中没有相关信息，请明确说明
    3. 回答要详细完整，条理清晰
    4. 使用中文回答
    5. 每个回答前请用“1.”、“2.”、“3.”编号
    
    ==================================================
    
    
    Generated Answers: ['根据提供的文档片段，哆啦A梦使用的三个秘密道具分别是：可以临时赋予超级战力的“复制斗篷”，能暂停时间五秒的“时间停止手表”，以及可在一分钟中完成一年修行的“精神与时光屋便携版”。这些道具在关键时刻为大雄提供了极大的帮助。', '从文档片段2中，我们可以得知哆啦A梦携带的秘密道具包括：可以临时赋予使用者强大战力的“复制斗篷”、以及能够支援战斗的“任意门”，但文档未具体提到另外两个秘密道具。结合片段1的信息，这三个道具分别是：“复制斗篷”、“时间停止手表”和“精神与时光屋便携版”。', '文档片段中并未明确列出所有的秘密道具。根据片段1提供的信息，我们可以推测哆啦A梦的秘密道具至少包括：可以临时赋予超级战力的“复制斗篷”，能暂停时间五秒的“时间停止手表”，以及可在一分钟内完成一年修行的“精神与时光屋便携版”。这些道具在故事中起到了重要作用。']
    
    


```python
# %pip install google-generativeai

# The code you provided is a Python script that uses the `google-generativeai` library to generate content based on a given query and a list of text chunks. Here's a breakdown of what the code is doing:
from dotenv import load_dotenv
import google.generativeai as genai

load_dotenv()
google_client = genai.Client()

def generate(query: str, chunks: List[str]) -> str:
    prompt = f"""你是一位知识助手，请根据用户的问题和下列片段生成准确的回答。

用户问题: {query}

相关片段:
{"\n\n".join(chunks)}

请基于上述内容作答，不要编造信息。"""

    print(f"{prompt}\n\n---\n")

    response = google_client.models.generate_content(
        model="gemini-2.5-flash",
        contents=prompt
    )

    return response.text

answer = generate(query, reranked_chunks)
print(answer)
```
